# yaml-language-server: https://json.schemastore.org/taskfile.json
version: "3"

tasks:

  sync:
    desc: "Build the frontend locally and sync to all available native platforms"
    cmds:
      # First build the frontend
      - "pnpm frontend build"
      # Next sync the built frontend on Android and iOS
      - "pnpm frontend cap sync"
      # Now install Electron dependencies before syncing with Electron
      - "pnpm frontend sync:electroninstall"
      # Sync with Electorn (not included in "cap sync" since it is a community-maintained platform)
      - "pnpm frontend sync:electron"

  start:
    desc: "Run build frontend on given platform (ios, android, or desktop), like so: `task js:start -- desktop`"
    cmds:
      - "pnpm frontend {{.CLI_ARGS}}"

  # TODO: make this work locally (currently only works in containers)
  # for instance, variables need to be assigned and strict security settings disabled since not running behind Caddy
  # I could also prevent some tasks from running if not needed: https://taskfile.dev/#/usage?id=prevent-unnecessary-work
  watch:
    desc: "Build and watch all JS-related projects, with server running"
    deps:
      - watch:frontend
      - watch:backend
      - watch:start

  watch:backend: "pnpm backend dev"
  watch:frontend: "pnpm frontend dev"
  watch:start: "pnpm backend start"
