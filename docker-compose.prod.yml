version: "3"

services:

  caddy:
    logging:
      &logging
      driver: "fluentd"
      options:
        fluentd-address: "localhost:24224"
        fluentd-async: "true"
    restart: "always"
    volumes:
      - ./project/server/prod.Caddyfile:/etc/caddy/Caddyfile:ro
      - ./data/server:/srv:ro

  postgres:
    logging: *logging
    restart: "always"

  libraries:
    logging: *logging
    image: "doseofted/${COMPOSE_PROJECT_NAME}-libraries:v0.0.1"
    restart: "always"

  backend:
    logging: *logging
    image: "doseofted/${COMPOSE_PROJECT_NAME}-backend:v0.0.1"
    restart: "always"

  frontend:
    logging: *logging
    image: "doseofted/${COMPOSE_PROJECT_NAME}-frontend:v0.0.1"
    restart: "always"
