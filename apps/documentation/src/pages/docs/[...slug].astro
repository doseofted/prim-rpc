---
import Documentation from "@/layouts/Documentation.astro"
import { getCollection } from "astro:content"
import TableOfContents from "@/components/TableOfContents.astro"
import {
	documentationTableOfContentsTree,
	createTableOfContentsFromTree,
	type CollectionTree,
	type CollectionType,
} from "@/utils/table-of-contents"

interface Props {
	entry: CollectionType
	tableOfContentsTree: CollectionTree<CollectionType["data"]>
}
export async function getStaticPaths() {
	const documentation = await getCollection("docs")
	const tableOfContentsTree = documentationTableOfContentsTree(documentation)
	return documentation.map(entry => {
		const { slug } = entry
		const params = { slug }
		const props = { entry, tableOfContentsTree }
		return { params, props }
	})
}

const { entry, tableOfContentsTree } = Astro.props
const { Content, headings } = await entry.render()
const { versions, tableOfContents } = createTableOfContentsFromTree(tableOfContentsTree, Astro.params.slug)
---

<Documentation
	decorationText="The Docs."
	title={entry.data.title}
	tableOfContents={tableOfContents}
	versions={versions}>
	<Content />
	<TableOfContents headings={headings} slot="extra" />
</Documentation>
